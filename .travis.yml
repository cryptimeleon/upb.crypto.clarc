language: java
install: true
jdk:
- openjdk8
- openjdk11
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
stages:
- name: build
- name: snapshot
  if: branch = master
- name: release
  if: branch = release
jobs:
  include:
  - stage: build
    script: "./gradlew build"
  - stage: snapshot
    script: "./gradlew publish -x test -Dsnapshot=true -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
  - stage: release
    script: "./gradlew publish -x test -Dnexus.user=$NEXUS_USER -Dnexus.key=$NEXUS_KEY
      -Dbuild.number=$TRAVIS_BUILD_NUMBER"
deploy:
  provider: releases
  api_key:
    secure: e2AhIbIvcN8gfX/cvpAyIPQ6FA6zarDVlywkZfT3jIdswZvbOPe36ZZdmDfc0xiSeOIWe067H/8hr+NiKE0Mm5qtrXjHzAmq4nhc1VY6Ijcrbv/dVJW8slCkr0EqYa/NiMNg0ImkavD8r4JMNcThmt+BBx79Kw0WaDpeH1pAxIiZOuLwEBDfLpOQYvA2WtWa6xDoqisZUDBdmCdvubew13/mOc0cvNe21pCWlimyTXtVjeriMKAVtueRrTeTSWC2nj5Tr0XfVYY1sTJqOoRpWuSUtuR2gVvqNLDUp8pPGfisrXcsfiQy8jnDujl+Fz26kndi1q+rQqWZ2cdK9ahovmgb2LeOyQ3Vg5xgL0jLndp/jZ3KPE+7P04MMo2vH+MrrdVaUH/rwKuM96Y3SguUJEstpPtCZRVhXBYU4pq7w1bK2YZiQJtOg3X0rVl34X7CsHI33QHcHNfAv50DXezjzP+OoCCI/gahSGKQL3el35kP3I3Goeddp+V5cLjf4nVKfIV1fWpj0afES7oBEVOI4l4+uf7sXb7gKG6fNGE/Nj/iLhecosr+xmfZzWIcLKmKvYPno3blnHMlN7VIJiVOCweryGMPKM77RtaGS6vId+WD9w8CLklPIeKbMDUxKghGghbnisghWj9M1XByd0qHZLRIUaSuNEKmp7Q1x6sIedU=
  file_glob: true
  file: build/libs/*
  skip_cleanup: true
  on:
    repo: upbcuk/upb.crypto.clarc
    branch: release